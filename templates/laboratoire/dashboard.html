{% extends 'base.html' %}
{% load static %}

{% block title %}Tableau de bord Laboratoire{% endblock %}

{% block extra_css %}
<style>
.quick-actions {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.5rem;
}
.quick-action-btn {
    flex: 1;
    padding: 1rem;
    border-radius: 0.5rem;
    background: #f1f3f4;
    border: none;
    font-weight: bold;
    color: #dc3545;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    transition: background 0.2s;
    text-decoration: none;
}
.quick-action-btn:hover {
    background: #e9ecef;
}
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2>Bonjour {{ laboratoire.nom }}</h2>

  <!-- Actions rapides -->
  <div class="quick-actions">
    <a href="{% url 'commandes_tests' %}" class="quick-action-btn"><i class="fas fa-tasks"></i> Voir les commandes de tests</a>
  </div>

  <div class="row">
    <!-- Bloc résultats de tests récents -->
    <div class="col-md-6">
      <div class="card mb-3">
        <div class="card-header bg-info text-white">Résultats de tests récents</div>
        <div class="card-body">
          <ul class="list-group">
            {% for resultat in resultats_recents %}
              <li class="list-group-item">
                <b>{{ resultat.date_heure|date:'d/m/Y H:i' }}</b> — {{ resultat.patient.user.get_full_name }}<br>
                <small>{{ resultat.motif }}</small>
                <a href="{{ resultat.fichier.url }}" class="btn btn-sm btn-success">Voir PDF</a>
              </li>
            {% empty %}
              <li class="list-group-item">Aucun résultat récent.</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
    <!-- Bloc état des tests en cours -->
    <div class="col-md-6">
      <div class="card mb-3">
        <div class="card-header bg-primary text-white">Tests en cours</div>
        <div class="card-body">
          <ul class="list-group">
            {% for analyse in analyses_en_cours %}
              <li class="list-group-item">
                <b>{{ analyse.date_heure|date:'d/m/Y H:i' }}</b> — {{ analyse.patient.user.get_full_name }}<br>
                <small>{{ analyse.motif }}</small>
                <span class="badge bg-warning text-dark">{{ analyse.statut }}</span>
              </li>
            {% empty %}
              <li class="list-group-item">Aucun test en cours.</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Bloc notifications des nouveaux tests -->
  <div class="row">
    <div class="col-md-12">
      <div class="card mb-3">
        <div class="card-header bg-warning text-dark">Notifications</div>
        <div class="card-body">
          <ul class="list-group">
            {% for notif in notifications %}
              <li class="list-group-item">
                <b>{{ notif.date|date:'d/m/Y H:i' }}</b> — {{ notif.message }}
              </li>
            {% empty %}
              <li class="list-group-item">Aucune notification.</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} 